<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4th encounter solver</title>
    <style>
        h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
        }

        .slot {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* スロット間の余白を追加 */
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, auto);
            grid-gap: 5px; /* ボタン間の余白を追加 */
        }

        .num-set-button {
            font-size: 16px;
            padding: 5px 15px; /* ボタンの縦をわずかに縮小 */
        }

        .selected {
            background-color: lightblue; /* 選択されたボタンの背景色 */
        }

        .slot:nth-of-type(n+4) {
            margin-top: 10px; /* スロット表D1、表E1、表F1の縦方向の余白を追加 */
        }

        button {
            font-size: 16px;
            padding: 5px 20px; /* 入力クリアボタンを少し大きくし、縦をわずかに縮小 */
        }

        .extra-padding {
            margin-top: 10px; /* 表D1、表E1、表F1の上下余白を追加 */
        }

        .reduced-height {
            line-height: 0.6; /* 表D3、表E3、表F3の高さを縮める */
        }
    </style>
</head>
<body>
    <h1>4th encounter solver</h1>
    <div>
        <div class="slot">
            <h2>裏左：</h2>
            <div>
                <button class="num-set-button num-set-button-A" onclick="selectButton(event)">▲</button>
                <button class="num-set-button num-set-button-A" onclick="selectButton(event)">■</button>
                <button class="num-set-button num-set-button-A" onclick="selectButton(event)">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>裏中：</h2>
            <div>
                <button class="num-set-button num-set-button-B" onclick="selectButton(event)">▲</button>
                <button class="num-set-button num-set-button-B" onclick="selectButton(event)">■</button>
                <button class="num-set-button num-set-button-B" onclick="selectButton(event)">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>裏右：</h2>
            <div>
                <button class="num-set-button num-set-button-C" onclick="selectButton(event)">▲</button>
                <button class="num-set-button num-set-button-C" onclick="selectButton(event)">■</button>
                <button class="num-set-button num-set-button-C" onclick="selectButton(event)">●</button>
            </div>
        </div>
        <div class="slot extra-padding">
            <h2>表左：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-D" onclick="selectButton(event)">球体</button>
                <button class="num-set-button num-set-button-D" onclick="selectButton(event)">立方体</button>
                <button class="num-set-button num-set-button-D" onclick="selectButton(event)">三角錐</button>
                <button class="num-set-button num-set-button-D" onclick="selectButton(event)">円柱</button>
                <button class="num-set-button num-set-button-D" onclick="selectButton(event)">円錐</button>
                <button class="num-set-button num-set-button-D" onclick="selectButton(event)">三角柱</button>
            </div>
        </div>    
        <div class="slot extra-padding">
            <h2>表中：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-E" onclick="selectButton(event)">球体</button>
                <button class="num-set-button num-set-button-E" onclick="selectButton(event)">立方体</button>
                <button class="num-set-button num-set-button-E" onclick="selectButton(event)">三角錐</button>
                <button class="num-set-button num-set-button-E" onclick="selectButton(event)">円柱</button>
                <button class="num-set-button num-set-button-E" onclick="selectButton(event)">円錐</button>
                <button class="num-set-button num-set-button-E" onclick="selectButton(event)">三角柱</button>
            </div>
        </div>
        <div class="slot extra-padding">
            <h2>表右：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-F" onclick="selectButton(event)">球体</button>
                <button class="num-set-button num-set-button-F" onclick="selectButton(event)">立方体</button>
                <button class="num-set-button num-set-button-F" onclick="selectButton(event)">三角錐</button>
                <button class="num-set-button num-set-button-F" onclick="selectButton(event)">円柱</button>
                <button class="num-set-button num-set-button-F" onclick="selectButton(event)">円錐</button>
                <button class="num-set-button num-set-button-F" onclick="selectButton(event)">三角柱</button>
            </div>
        </div>
        <button class="clear-button" onclick="clearSelection()">入力クリア</button>
        <div>
            <h2>裏セット：</h2>
            <div id="ura-set"></div>
        </div>
        <div>
            <h2>正解の形：</h2>
            <div id="correct-form"></div>
        </div>
        <div>
            <h2>表セット：</h2>
            <div id="omote-set"></div>
        </div>
        <div>
            <h2>解剖アクション：</h2>
            <div id="actions"></div>
        </div>
    </div>

    <script>
        function clearSelection() {
            // Clear all selected buttons
            document.querySelectorAll('.num-set-button').forEach(button => {
                button.classList.remove('selected');
            });
            // Clear results
            document.getElementById('ura-set').innerHTML = '';
            document.getElementById('correct-form').innerHTML = '';
            document.getElementById('omote-set').innerHTML = '';
            document.getElementById('actions').innerHTML = '';
        }

        function selectButton(event) {
            const parentDiv = event.target.closest('.slot');
            const buttons = parentDiv.querySelectorAll('.num-set-button');
            buttons.forEach(button => button.classList.remove('selected'));
            event.target.classList.add('selected');
            updateResults();
        }

        function updateResults() {
            const uraSet = getUraSet();
            const correctForm = getCorrectForm(uraSet);
            const omoteSet = getOmoteSet();
            const actions = calculateActions(omoteSet, correctForm);

            document.getElementById('ura-set').innerText = `(${uraSet.join(', ')})`;
            document.getElementById('correct-form').innerText = JSON.stringify(correctForm);
            document.getElementById('omote-set').innerText = JSON.stringify(omoteSet);
            document.getElementById('actions').innerText = actions.join(', ');
        }

        function getUraSet() {
            const selected = document.querySelectorAll('.num-set-button-A.selected, .num-set-button-B.selected, .num-set-button-C.selected');
            return Array.from(selected).map(button => button.textContent);
        }

        function getCorrectForm(uraSet) {
            const allSymbols = ['▲', '■', '●'];
            return uraSet.map(selected => allSymbols.filter(symbol => symbol !== selected));
        }

        function getOmoteSet() {
            const selected = document.querySelectorAll('.num-set-button-D.selected, .num-set-button-E.selected, .num-set-button-F.selected');
            const mapping = {
                '球体': ['●', '●'],
                '立方体': ['■', '■'],
                '三角錐': ['▲', '▲'],
                '円柱': ['■', '●'],
                '円錐': ['▲', '●'],
                '三角柱': ['▲', '■']
            };
            return Array.from(selected).map(button => mapping[button.textContent]);
        }

        function calculateActions(omoteSet, correctForm) {
            const actions = [];
            const positions = ['左', '中', '右'];

            // Function to find the index of an element in an array of arrays
            function findIndex(arr, element) {
                for (let i = 0; i < arr.length; i++) {
                    if (JSON.stringify(arr[i]) === JSON.stringify(element)) {
                        return i;
                    }
